@page "/login"
@using Auth0.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Http
@using System.Threading.Tasks;

@code {
    [CascadingParameter]
    public HttpContext? HttpContext { get; set; }

    [Inject]
    public NavigationManager? NavigationManager { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (HttpContext == null) throw new NullReferenceException(nameof(HttpContext));
        if (NavigationManager == null) throw new NullReferenceException(nameof(NavigationManager));

        string redirectUri = @"/";

        if (HttpContext.User.Identity != null
            && HttpContext.User.Identity.IsAuthenticated)
        {
            NavigationManager.NavigateTo(redirectUri);
        }

        var authenticationProperties = new LoginAuthenticationPropertiesBuilder()
            .WithRedirectUri(redirectUri)
            .Build();

        await HttpContext.ChallengeAsync(
            Auth0Constants.AuthenticationScheme,
            authenticationProperties).ConfigureAwait(false);
    }
}
